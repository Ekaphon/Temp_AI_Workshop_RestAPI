# Contributing Guidelines

Purpose
- Keep API, DB and docs consistent. Follow these rules when contributing code, tests or docs.

Getting started (local)
- Clone repo and install deps:
  - go version >= 1.24
  - GOPROXY (optional) e.g. `export GOPROXY=direct`
  - Install modules: `go mod tidy`
- Start app: `go run main.go` or run VS Code task `Run Go Fiber Server`
- DB file: `app.db` created in project root by GORM `InitDB()`

Coding style
- Use `gofmt`/`gofmt -w .` before commit.
- Keep exports documented. Prefer short, clear functions.
- Use meaningful variable names and avoid global state where possible.

Go project layout
- `main.go` — app bootstrap and routes
- `auth.go` — authentication handlers, middleware
- `models.go` — GORM models (source of truth for schema)
- `db.go` — DB initialization and AutoMigrate
- `docs/` — generated Swagger (run `swag init` to regenerate)
- `design/` — diagrams (Mermaid)

Branching & commits
- Work on feature branches: `feature/<short-description>`
- Commit message template: `<type>(<area>): <short summary>`
  - types: feat, fix, docs, refactor, test, chore
- Squash/fixup locally when appropriate; keep history readable.

Pull requests
- Target branch `main`
- Include short description, testing steps, and any migration notes
- Link related issue (if exists)
- Ensure CI passes before requesting review

Formatting & lint
- Run `gofmt -w .`
- Run `go vet ./...`
- Optional: run `golangci-lint` if added to CI

Testing
- Add unit tests for business logic where possible
- CI will run `go build` and `go vet` (see `.github/workflows/ci.yml`)

Database & migrations
- The schema is defined in `models.go`. `InitDB()` calls `DB.AutoMigrate(&User{})`.
- For manual inspection: `sqlite3 app.db ".schema users"` or `sqlite3 -header -column app.db "SELECT * FROM users;"`
- To reset DB in dev: remove `app.db` and restart app.

Authentication & security
- JWT secret must be provided via env `JWT_SECRET` in production — do NOT commit secrets.
- Passwords are bcrypt-hashed.
- Protect sensitive endpoints with `RequireAuth` middleware.

Swagger / API docs
- Use `swag` to generate docs:
  - Install: `go install github.com/swaggo/swag/cmd/swag@latest`
  - Generate: `swag init -g main.go`
- `docs/` contains generated `swagger.json` / `swagger.yaml` and `docs.go`. Commit generated docs only when API signature changes.

CI / Docker
- CI workflow at `.github/workflows/ci.yml` builds and runs `go vet`.
- Dockerfile provided for container builds.

Review checklist
- Code compiles: `go build ./...`
- Tests (if any) pass
- `gofmt` applied
- No secrets in commits
- Swagger docs updated if endpoints changed
- DB migrations or model changes documented

Contact / Questions
- Open an issue or mention the maintainer in PR for architecture or security questions.

# Repository instructions (for Copilot)

Project context
- Language: Go (>=1.24). Framework: Fiber v2. Database: SQLite via GORM.
- Purpose: Small REST API for authentication and user profile management. Main files: `main.go`, `auth.go`, `models.go`, `db.go`.
- Runtime files: `app.db` (SQLite), generated Swagger in `docs/`, Mermaid diagrams in `design/`.

Coding conventions
- Format all Go code with `gofmt -w .` before suggesting commits.
- Use clear, short functions and small focused changes.
- Prefer using Fiber idioms (handlers with `func(c *fiber.Ctx) error`), GORM for DB operations, bcrypt for password hashing, and `github.com/golang-jwt/jwt/v5` for JWT.
- Use dependency versions present in `go.mod`. Prefer `go mod tidy` to update dependencies.

API & DB behaviors
- Auth: register (bcrypt), login (returns JWT). JWT secret read from env `JWT_SECRET`.
- Schema source of truth: `models.go`. `InitDB()` in `db.go` calls `DB.AutoMigrate(&User{})`.
- For profile updates: expose `GET /profile` and `PUT /profile` protected by `RequireAuth` (Bearer token).
- Swagger docs generated by `swag init` (placed in `docs/`). Keep `docs/` updated when endpoints change.

Security & secrets
- Never include secrets (JWT_SECRET, tokens, DB credentials) in code or commits.
- Recommend environment usage for secrets. Warn when suggesting code that hardcodes credentials.

Testing, CI & release
- CI runs `go mod tidy`, `go build ./...`, and `go vet ./...` (see `.github/workflows/ci.yml`).
- Suggest unit tests for business logic (password hashing, JWT generation, validation).
- Use `docker build` with provided `Dockerfile` for containerization.

Documentation & UX
- Update Swagger with endpoint request/response schemas when changing APIs. Use `swag` CLI:
  - `go install github.com/swaggo/swag/cmd/swag@latest`
  - `swag init -g main.go`
- Keep `design/detail.md` (Mermaid) in sync with API flow and ER diagram.

Git & commit guidance
- Work on feature branches: `feature/<short-descr>`.
- Commit style: `<type>(<area>): <short summary>` where type ∈ {feat, fix, docs, chore, test, refactor}.
- Do not commit build artifacts (`server`, `app.db`) — `.gitignore` must exclude these.

What to do when asked to modify the repo
- Make minimal, focused edits and explain changes in one-line commit message.
- Add or update tests where appropriate.
- If updating API surface, update Swagger docs and `docs/swagger.json` / `docs/swagger.yaml`.
- Regenerate `go.sum` by running `go mod tidy`.
- Ensure code builds: `go build ./...`.

Outputs format
- For code changes: provide exact file edits and a short explanation.
- For commands: provide shell commands for macOS zsh.
- For examples: include minimal curl examples demonstrating usage (register/login/profile).

Things to avoid
- Do not add or suggest storing secrets in source code.
- Avoid large unrelated refactors in the same PR.
- Avoid adding obscure dependencies without justification.

Example prompts that match this repo
- "Add PUT /profile handler to update first_name, last_name, phone, member_level and points, with validation and unit tests."
- "Generate Swagger docs for the auth endpoints and commit `docs/swagger.json`."
- "Add an integration test that registers a user, logs in, updates profile, and verifies DB row."

If unclear, ask a clarifying question before making code edits.